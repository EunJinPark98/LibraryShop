<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminMapper">
    <!--상품 카테고리 조회-->
    <select id="selectCateList" resultMap="itemMapper.category">
        SELECT CATE_CODE
            , CATE_NAME
        FROM ITEM_CATEGORY
    </select>

    <!--상품 등록-->
    <insert id="insertItem">
        INSERT INTO SHOP_ITEM (
            ITEM_CODE
            , ITEM_NAME
            , ITEM_PRICE
            , ITEM_INTRO
            , CATE_CODE
        ) VALUES (
            (SELECT 'ITEM_'|| LPAD(NVL(MAX(TO_NUMBER(SUBSTR(ITEM_CODE, 6))), 0) + 1, 3 ,'0')
                FROM SHOP_ITEM)
            , #{itemName}
            , #{itemPrice}
            , #{itemIntro}
            , #{cateCode}
        )
    </insert>

    <!--모든 상품 목록 조회-->
    <select id="selectItemList" resultMap="itemMapper.item">
        SELECT ITEM_CODE
            , ITEM_NAME
            , ITEM_PRICE
            , ITEM_STOCK
            , ITEM_STATUS
        FROM SHOP_ITEM
        WHERE 1 = 1
        <if test='searchCateCode != null and !searchCateCode.equals("")'>
            AND CATE_CODE = #{searchCateCode}
        </if>
        <if test="searchItemStatus != null">
            AND ITEM_STATUS IN
            <foreach collection="searchItemStatus" item="itemStatus" separator="," open="(" close=")">
                #{itemStatus}
            </foreach>
        </if>
        <if test='searchItemName != null and !searchItemName.equals("")'>
            AND UPPER(ITEM_NAME) LIKE '%'||UPPER(#{searchItemName})||'%'
        </if>
        <if test='searchItemStockMin != null and !searchItemStockMin.equals("")'>
            AND ITEM_STOCK &gt;= #{searchItemStockMin}
        </if>
        <if test='searchItemStockMax != null and !searchItemStockMax.equals("")'>
            AND ITEM_STOCK &lt;= #{searchItemStockMax}
        </if>
        ORDER BY ITEM_CODE DESC
    </select>

    <!--재고 수정-->
    <update id="updateStock">
        UPDATE SHOP_ITEM
        SET ITEM_STOCK = #{itemStock}
        WHERE ITEM_CODE = #{itemCode}
    </update>

    <!--상품 상태 변경-->
    <update id="updateStatus">
        UPDATE SHOP_ITEM
        SET ITEM_STATUS = #{itemStatus}
        WHERE ITEM_CODE = #{itemCode}
    </update>

</mapper>